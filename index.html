<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cek History Realisasi ID Card</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8f9fa;
    }
    h2 {
      text-align: center;
    }
    input {
      padding: 8px;
      width: 250px;
      margin-right: 10px;
    }
    button {
      padding: 8px 15px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center; /* rata tengah semua */
    }
    th {
      background-color: #007bff;
      color: white;
    }
    /* Perlebar kolom Nama & Jabatan */
    td:nth-child(3), th:nth-child(3) { min-width: 200px; }
    td:nth-child(5), th:nth-child(5) { min-width: 200px; }
  </style>
</head>
<body>
  <h2>History Realisasi ID Card</h2>
  <div style="text-align:center;">
    <input type="text" id="searchId" placeholder="Masukkan Nomor ID">
    <button onclick="searchData()">Cari</button>
  </div>
  <table id="resultTable">
    <thead>
      <tr>
        <th>Tgl Pengajuan</th>
        <th>Tgl Proses</th>
        <th>Nama</th>
        <th>No ID</th>
        <th>Jabatan</th>
        <th>Validasi</th>
        <th>Company</th>
        <th>Jml</th>
        <th>Blangko</th>
        <th>Reason</th>
        <th>Shipment</th>
        <th>Counter</th>
        <th>Dicetak Oleh</th>
        <th>Tgl Distribusi</th>
        <th>Status Pengembalian</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "PASTE_WEB_APP_URL_HERE"; // ganti dengan URL Web App Apps Script kamu

    // Format Tanggal dd-MMM-yyyy
    function formatDate(dateString) {
      if (!dateString) return "";
      const options = { day: '2-digit', month: 'short', year: 'numeric' };
      return new Date(dateString).toLocaleDateString('en-GB', options).replace(/ /g, '-');
    }

    // Format Bulan-Tahun (Validasi)
    function formatMonthYear(dateString) {
      if (!dateString) return "";
      const options = { month: 'short', year: 'numeric' };
      return new Date(dateString).toLocaleDateString('en-GB', options).replace(" ", "-");
    }

    async function searchData() {
      const id = document.getElementById("searchId").value.trim();
      if (!id) {
        alert("Masukkan Nomor ID dulu!");
        return;
      }

      try {
        const res = await fetch(`${API_URL}?id=${id}`);
        const data = await res.json();

        const tbody = document.querySelector("#resultTable tbody");
        tbody.innerHTML = "";

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="16">Data tidak ditemukan</td></tr>`;
          return;
        }

        data.forEach(row => {
          const tr = document.createElement("tr");
          row.forEach((cell, i) => {
            const td = document.createElement("td");

            if ([0,1,13].includes(i)) {
              // Tgl Pengajuan, Tgl Proses, Tgl Distribusi
              td.textContent = formatDate(cell);
            } else if (i === 5) {
              // Validasi
              td.textContent = formatMonthYear(cell);
            } else {
              td.textContent = cell;
            }

            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error("Error fetching data:", err);
        alert("Gagal mengambil data. Cek koneksi atau API URL!");
      }
    }
  </script>
</body>
</html>
